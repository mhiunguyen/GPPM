# üì¶ H∆∞·ªõng d·∫´n C√†i ƒë·∫∑t Chi ti·∫øt - DermaSafe AI

T√†i li·ªáu n√†y cung c·∫•p h∆∞·ªõng d·∫´n c√†i ƒë·∫∑t chi ti·∫øt cho DermaSafe AI tr√™n c√°c h·ªá ƒëi·ªÅu h√†nh kh√°c nhau.

---

## üìã M·ª•c l·ª•c

- [Y√™u c·∫ßu H·ªá th·ªëng](#y√™u-c·∫ßu-h·ªá-th·ªëng)
- [C√†i ƒë·∫∑t Docker](#c√†i-ƒë·∫∑t-docker)
- [C√†i ƒë·∫∑t D·ª± √°n](#c√†i-ƒë·∫∑t-d·ª±-√°n)
- [C·∫•u h√¨nh Environment](#c·∫•u-h√¨nh-environment)
- [Ch·∫°y ·ª®ng d·ª•ng](#ch·∫°y-·ª©ng-d·ª•ng)
- [X·ª≠ l√Ω S·ª± c·ªë](#x·ª≠-l√Ω-s·ª±-c·ªë)

---

## üñ•Ô∏è Y√™u c·∫ßu H·ªá th·ªëng

### Ph·∫ßn c·ª©ng T·ªëi thi·ªÉu

| Th√†nh ph·∫ßn | Y√™u c·∫ßu t·ªëi thi·ªÉu | Khuy·∫øn ngh·ªã |
|------------|-------------------|-------------|
| **CPU** | 4 cores (x86_64 / ARM64) | 8+ cores |
| **RAM** | 8 GB | 16 GB+ |
| **Storage** | 10 GB tr·ªëng | 20 GB+ SSD |
| **GPU** | Kh√¥ng b·∫Øt bu·ªôc | NVIDIA GPU v·ªõi 4GB+ VRAM |

### H·ªá ƒëi·ªÅu h√†nh H·ªó tr·ª£

- ‚úÖ **Ubuntu** 20.04+ / Debian 11+
- ‚úÖ **macOS** 12+ (Intel & Apple Silicon)
- ‚úÖ **Windows** 10/11 (v·ªõi WSL2)
- ‚úÖ **Docker Desktop** tr√™n c√°c platform tr√™n

### Ph·∫ßn m·ªÅm Y√™u c·∫ßu

| Ph·∫ßn m·ªÅm | Phi√™n b·∫£n | M·ª•c ƒë√≠ch |
|----------|-----------|----------|
| **Docker** | 24.0+ | Container runtime |
| **Docker Compose** | 2.0+ | Multi-container orchestration |
| **Git** | 2.30+ | Version control |
| **Python** (optional) | 3.12+ | Development without Docker |
| **Node.js** (optional) | 18+ | Frontend development |

---

## üê≥ C√†i ƒë·∫∑t Docker

### Ubuntu / Debian

```bash
# 1. G·ª° c√†i ƒë·∫∑t c√°c phi√™n b·∫£n c≈© (n·∫øu c√≥)
sudo apt-get remove docker docker-engine docker.io containerd runc

# 2. C·∫≠p nh·∫≠t apt v√† c√†i ƒë·∫∑t dependencies
sudo apt-get update
sudo apt-get install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# 3. Th√™m Docker GPG key
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
    sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# 4. Th√™m Docker repository
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 5. C√†i ƒë·∫∑t Docker Engine
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 6. Th√™m user v√†o docker group (ƒë·ªÉ ch·∫°y kh√¥ng c·∫ßn sudo)
sudo usermod -aG docker $USER
newgrp docker

# 7. Ki·ªÉm tra c√†i ƒë·∫∑t
docker --version
docker compose version
```

### macOS

**Option 1: Docker Desktop (Khuy·∫øn ngh·ªã)**
```bash
# Download v√† c√†i ƒë·∫∑t Docker Desktop t·ª´:
# https://www.docker.com/products/docker-desktop/

# Sau khi c√†i ƒë·∫∑t, ki·ªÉm tra:
docker --version
docker compose version
```

**Option 2: Homebrew**
```bash
# C√†i ƒë·∫∑t Docker qua Homebrew
brew install docker docker-compose

# Kh·ªüi ƒë·ªông Docker daemon
open -a Docker

# Ki·ªÉm tra
docker --version
docker compose version
```

### Windows (WSL2)

1. **K√≠ch ho·∫°t WSL2**
```powershell
# Ch·∫°y PowerShell as Administrator
wsl --install
wsl --set-default-version 2
```

2. **C√†i ƒë·∫∑t Ubuntu trong WSL2**
```powershell
wsl --install -d Ubuntu-22.04
```

3. **C√†i ƒë·∫∑t Docker Desktop**
   - Download t·ª´: https://www.docker.com/products/docker-desktop/
   - Enable "Use WSL 2 based engine" trong Settings

4. **Ki·ªÉm tra trong WSL2**
```bash
docker --version
docker compose version
```

---

## üì• C√†i ƒë·∫∑t D·ª± √°n

### 1. Clone Repository

```bash
# Clone t·ª´ GitHub
git clone https://github.com/mhiunguyen/GPPM.git
cd GPPM

# Ki·ªÉm tra branch
git branch
git status
```

### 2. C·∫•u tr√∫c Th∆∞ m·ª•c

Sau khi clone, b·∫°n s·∫Ω c√≥ c·∫•u tr√∫c:

```
GPPM/
‚îú‚îÄ‚îÄ frontend/              # React frontend
‚îú‚îÄ‚îÄ backend-api/           # FastAPI backend
‚îú‚îÄ‚îÄ ai-service/            # AI analysis service
‚îú‚îÄ‚îÄ chatbot-service/       # Gemini chatbot
‚îú‚îÄ‚îÄ dermatology_module/    # Dermatology analysis
‚îú‚îÄ‚îÄ smart_derma_capture/   # Smart capture module
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker orchestration
‚îú‚îÄ‚îÄ quick_start.sh        # Quick start script
‚îî‚îÄ‚îÄ README.md
```

---

## ‚öôÔ∏è C·∫•u h√¨nh Environment

### 1. Backend API Environment

```bash
cd backend-api

# T·∫°o file .env
cat > .env << 'EOF'
# Database Configuration (matches docker-compose.yml)
DATABASE_URL=postgresql://dermasafe_user:dermasafe_pass@postgres:5432/dermasafe

# API Configuration
API_HOST=0.0.0.0
API_PORT=8000
ENVIRONMENT=development

# External Services
AI_SERVICE_URL=http://ai-service:8001
CHATBOT_SERVICE_URL=http://chatbot:8002

# CORS Origins
CORS_ORIGINS=["http://localhost:5173","http://localhost:3000"]

# Logging
LOG_LEVEL=INFO
EOF

cd ..
```

### 2. AI Service Environment

```bash
cd ai-service

# T·∫°o file .env
cat > .env << 'EOF'
# AI Service Configuration
API_HOST=0.0.0.0
API_PORT=8001
ENVIRONMENT=development

# Model Configuration
MODEL_NAME=SkinGPT-project/DermLIP-CLIP
DEVICE=cpu  # ƒê·ªïi th√†nh 'cuda' n·∫øu c√≥ GPU
MODEL_CACHE_DIR=./models

# Processing Configuration
MAX_IMAGE_SIZE=1024
BATCH_SIZE=1

# Logging
LOG_LEVEL=INFO
EOF

cd ..
```

### 3. Chatbot Service Environment

```bash
cd chatbot-service

# T·∫°o file .env
cat > .env << 'EOF'
# Chatbot Service Configuration
API_HOST=0.0.0.0
API_PORT=8002
ENVIRONMENT=development

# Google Gemini API
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-1.5-flash

# Logging
LOG_LEVEL=INFO
EOF

cd ..
```

**‚ö†Ô∏è Quan tr·ªçng**: Thay `your_gemini_api_key_here` b·∫±ng API key th·ª±c t·ª´ [Google AI Studio](https://makersuite.google.com/app/apikey)

### 4. Frontend Environment (Optional)

```bash
cd frontend

# T·∫°o file .env (n·∫øu c·∫ßn custom)
cat > .env << 'EOF'
VITE_API_URL=http://localhost:8000
VITE_CHATBOT_URL=http://localhost:8002
EOF

cd ..
```

---

## üöÄ Ch·∫°y ·ª®ng d·ª•ng

### Option 1: Quick Start Script (Khuy·∫øn ngh·ªã)

```bash
# C·∫•p quy·ªÅn th·ª±c thi
chmod +x quick_start.sh

# Ch·∫°y script
./quick_start.sh
```

Script s·∫Ω:
- ‚úÖ Ki·ªÉm tra Docker
- ‚úÖ T·∫°o .env files
- ‚úÖ Build images (l·∫ßn ƒë·∫ßu ~10 ph√∫t)
- ‚úÖ Start containers
- ‚úÖ Health check

### Option 2: Docker Compose Manual

```bash
# Build t·∫•t c·∫£ services
docker compose build

# Start t·∫•t c·∫£ services
docker compose up -d

# Xem logs
docker compose logs -f

# Ho·∫∑c xem logs c·ªßa service c·ª• th·ªÉ
docker compose logs -f ai-service
docker compose logs -f backend-api
docker compose logs -f frontend
```

### Option 3: Rebuild Single Service

```bash
# Rebuild ch·ªâ m·ªôt service
docker compose build frontend
docker compose up -d frontend

# Rebuild v√† restart
docker compose up -d --build frontend
```

---

## üîç Ki·ªÉm tra C√†i ƒë·∫∑t

### 1. Ki·ªÉm tra Containers

```bash
# Li·ªát k√™ c√°c containers ƒëang ch·∫°y
docker compose ps

# Output mong ƒë·ª£i:
# NAME                 IMAGE              STATUS        PORTS
# gppm-frontend-1      gppm-frontend      Up X mins     0.0.0.0:5173->5173/tcp
# gppm-backend-api-1   gppm-backend-api   Up X mins     0.0.0.0:8000->8000/tcp
# gppm-ai-service-1    gppm-ai-service    Up X mins     0.0.0.0:8001->8001/tcp
# gppm-chatbot-1       gppm-chatbot       Up X mins     0.0.0.0:8002->8002/tcp
# gppm-postgres-1      postgres:15        Up X mins     0.0.0.0:5432->5432/tcp
```

### 2. Health Checks

```bash
# Backend API
curl http://localhost:8000/health
# Expected: {"status":"ok"}

# AI Service
curl http://localhost:8001/health
# Expected: {"status":"ok","model_loaded":true}

# Chatbot Service
curl http://localhost:8002/health
# Expected: {"status":"ok"}

# Frontend
curl http://localhost:5173
# Expected: HTML response
```

### 3. Truy c·∫≠p Web

M·ªü browser v√† truy c·∫≠p:
- üåê **Frontend**: http://localhost:5173
- üìö **API Docs (Backend)**: http://localhost:8000/docs
- ü§ñ **API Docs (AI)**: http://localhost:8001/docs
- üí¨ **API Docs (Chatbot)**: http://localhost:8002/docs

---

## üõ†Ô∏è Development Mode

### Ch·∫°y Frontend Dev Server (Hot Reload)

```bash
cd frontend

# C√†i ƒë·∫∑t dependencies
npm install

# Start dev server
npm run dev

# Frontend s·∫Ω ch·∫°y t·∫°i http://localhost:5173 v·ªõi hot reload
```

### Ch·∫°y Backend v·ªõi Auto-reload

```bash
cd backend-api

# C√†i ƒë·∫∑t dependencies
pip install -r requirements.txt

# Start v·ªõi reload
uvicorn backend_app.main:app --reload --host 0.0.0.0 --port 8000
```

### Database Migrations

```bash
cd backend-api

# T·∫°o migration m·ªõi
alembic revision --autogenerate -m "Description"

# Apply migrations
alembic upgrade head

# Rollback
alembic downgrade -1
```

---

## üêõ X·ª≠ l√Ω S·ª± c·ªë

### 1. Docker Daemon kh√¥ng ch·∫°y

**Tri·ªáu ch·ª©ng:**
```
Cannot connect to the Docker daemon
```

**Gi·∫£i ph√°p:**
```bash
# Ubuntu/Debian
sudo systemctl start docker
sudo systemctl enable docker

# macOS
open -a Docker

# Ki·ªÉm tra
docker ps
```

### 2. Port ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng

**Tri·ªáu ch·ª©ng:**
```
Bind for 0.0.0.0:5173 failed: port is already allocated
```

**Gi·∫£i ph√°p:**
```bash
# T√¨m process ƒëang d√πng port
sudo lsof -i :5173
sudo lsof -i :8000
sudo lsof -i :8001

# Kill process
sudo kill -9 <PID>

# Ho·∫∑c thay ƒë·ªïi port trong docker-compose.yml
```

### 3. Out of Memory (OOM)

**Tri·ªáu ch·ª©ng:**
```
Container killed with OOM
```

**Gi·∫£i ph√°p:**
```bash
# TƒÉng memory limit trong docker-compose.yml
services:
  ai-service:
    mem_limit: 4g  # TƒÉng l√™n 4GB
    
# Restart
docker compose up -d
```

### 4. Model Download Failed

**Tri·ªáu ch·ª©ng:**
```
Failed to download model from HuggingFace
```

**Gi·∫£i ph√°p:**
```bash
# Set HuggingFace cache directory
export HF_HOME=/path/to/cache

# Ho·∫∑c download manually
cd ai-service
python -c "
from transformers import CLIPModel
model = CLIPModel.from_pretrained('SkinGPT-project/DermLIP-CLIP')
"
```

### 5. Permission Denied

**Tri·ªáu ch·ª©ng:**
```
Permission denied while trying to connect to Docker daemon
```

**Gi·∫£i ph√°p:**
```bash
# Th√™m user v√†o docker group
sudo usermod -aG docker $USER

# Logout v√† login l·∫°i, ho·∫∑c
newgrp docker
```

### 6. Frontend Build Failed

**Tri·ªáu ch·ª©ng:**
```
npm ERR! Failed at build script
```

**Gi·∫£i ph√°p:**
```bash
cd frontend

# Clear cache
rm -rf node_modules package-lock.json

# Reinstall
npm install

# Rebuild
docker compose build frontend
```

### 7. Database Connection Failed

**Tri·ªáu ch·ª©ng:**
```
could not connect to server: Connection refused
```

**Gi·∫£i ph√°p:**
```bash
# Ki·ªÉm tra PostgreSQL container
docker compose ps postgres

# Restart PostgreSQL
docker compose restart postgres

# Xem logs
docker compose logs postgres

# Ki·ªÉm tra connection
docker compose exec postgres psql -U postgres -c "SELECT 1"
```

---

## üîÑ C·∫≠p nh·∫≠t D·ª± √°n

### Pull Latest Changes

```bash
# Pull code m·ªõi
git pull origin main

# Rebuild containers
docker compose down
docker compose build
docker compose up -d

# Ho·∫∑c d√πng --no-cache ƒë·ªÉ build t·ª´ ƒë·∫ßu
docker compose build --no-cache
```

### Update Dependencies

```bash
# Backend
cd backend-api
pip install -r requirements.txt --upgrade

# Frontend
cd frontend
npm update

# Rebuild
docker compose build
```

---

## üßπ D·ªçn d·∫πp

### X√≥a Containers & Images

```bash
# Stop v√† x√≥a containers
docker compose down

# X√≥a containers, networks, v√† volumes
docker compose down -v

# X√≥a images
docker compose down --rmi all

# X√≥a m·ªçi th·ª© (bao g·ªìm volumes)
docker compose down -v --rmi all
```

### D·ªçn d·∫πp Docker System

```bash
# X√≥a containers kh√¥ng d√πng
docker container prune

# X√≥a images kh√¥ng d√πng
docker image prune -a

# X√≥a volumes kh√¥ng d√πng
docker volume prune

# D·ªçn d·∫πp to√†n b·ªô
docker system prune -a --volumes
```

---

## üìû H·ªó tr·ª£

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c li·ªát k√™ ·ªü tr√™n:

1. **Check logs**: `docker compose logs -f [service-name]`
2. **Search issues**: [GitHub Issues](https://github.com/mhiunguyen/GPPM/issues)
3. **Create issue**: M√¥ t·∫£ chi ti·∫øt v·∫•n ƒë·ªÅ + logs + environment
4. **Email**: contact@dermasafe.ai

---

## ‚úÖ Checklist C√†i ƒë·∫∑t Th√†nh c√¥ng

- [ ] Docker v√† Docker Compose ƒë√£ c√†i ƒë·∫∑t
- [ ] Repository ƒë√£ clone v·ªÅ
- [ ] File .env ƒë√£ ƒë∆∞·ª£c t·∫°o v√† c·∫•u h√¨nh
- [ ] `docker compose ps` hi·ªÉn th·ªã t·∫•t c·∫£ containers "Up"
- [ ] Health checks pass (8000, 8001, 8002)
- [ ] Frontend truy c·∫≠p ƒë∆∞·ª£c t·∫°i localhost:5173
- [ ] Upload ·∫£nh v√† ph√¢n t√≠ch ho·∫°t ƒë·ªông
- [ ] Chatbot ph·∫£n h·ªìi b√¨nh th∆∞·ªùng

Ch√∫c b·∫°n c√†i ƒë·∫∑t th√†nh c√¥ng! üéâ
